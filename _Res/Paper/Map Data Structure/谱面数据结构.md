# <img src="Logo.png" style="zoom:8%;" />   Stager Studio 谱面数据结构



> Stager Studio 的谱面文件为 `json` 格式的可阅读文本文件，保存在工程文件的内部，可以导出为独立的文本文件。



- [这里](https://github.com/Mo-enen/Stager-Map-Converter)可以下载 Stager Map Converter 在 Github 上的源文件，其中包含谱面数据结构的源码。

- 谱面文件的数据结构：
  
  - **bpm**：每分钟节拍数。整数；
  - **level**：难度等级。整数；
  - **tag**：标签，例如Easy，Hard。字符串；
  - **createdTime**：创建时间，从0001年1月1日12:00:00开始到此时的以ticks为单位的时间。长整数；
  - **shift**：网格偏移时间，不影响音符时间。整数，单位千分之一秒；
  - **ratio**：谱面长宽比。整数，值为 1000*长/宽；
  - **stages**：舞台，舞台对象组；
  - **tracks**：轨道，轨道对象组；
  - **notes**：音符，音符对象组；
  - **timings**：时间点，时间点对象组；
  
  
  
- 舞台对象的数据结构：

  - **time**：出现的时间。整数，单位千分之一秒；
  - **duration**：持续时长。整数，单位千分之一秒；
  - **itemType**：物体类型，用于修改外观。整数；
  - **speed**：下落速度倍数，影响位于舞台内的所有音符。整数，单位为千分之一倍；
  - **x**：横向位置，0表示主场景最左侧，1000表示主场景最右侧。整数；
  - **y**：纵向位置，0表示主场景底部，1000表示主场景顶部。整数；
  - **width**：宽度，0表示宽度无限小，1000表示与主场景宽度相同。整数；
  - **height**：高度，0表示高度无限小，1000表示与主场景**宽度**相同。整数；
  - **rotation**：旋转角度，0表示上方朝上，90表示上方朝右，180表示上方朝下。整数，单位度；
  - **pivotY**：纵向原点位置，舞台运动基准点的纵向位置（横向位置永远为正中间），0表示舞台底部，500表示舞台正中间，1000表示舞台顶部。整数；
  - **color**：颜色在调色板上的编号。整数；
  - **positions**：位置运动，类型为“时间-数-数-补间”组；
  - **rotations**：角度运动，类型为“时间-数-补间”组；
  - **colors**：颜色运动，类型为“时间-整数-补间”组；
  - **widths**：宽度运动，类型为“时间-数-补间”组；
  - **heights**：高度运动，类型为“时间-数-补间”组；



- 轨道对象的数据结构：
  - **time**：出现的时间。整数，单位千分之一秒；
  - **duration**：持续时长。整数，单位千分之一秒；
  - **itemType**：物体类型，用于修改外观。整数；
  - **speed**：下落速度倍数，影响位于轨道内的所有音符。整数，单位为千分之一倍；
  - **x**：横向位置，0表示舞台最左侧，1000表示舞台最右侧，基准点位于轨道纵向底部、横向中间。整数；
  - **width**：宽度，0表示宽度无限小，1000表示与舞台宽度相同。整数；
  - **angle**：倾斜角度，0表示不倾斜（与舞台重合），90表示像后倾斜（与舞台垂直）。整数；
  - **stageIndex**：舞台编号，决定该轨道位于哪个舞台中。整数；
  - **color**：颜色在调色板上的编号。整数；
  - **hasTray**：是否有托盘。类型为“是否值”；
  - **xs**：横向位置运动，类型为“时间-数-补间”组；
  - **angles**：倾斜角度运动，类型为“时间-数-补间”组；
  - **colors**：颜色运动，类型为“时间-整数-补间”组；
  - **widths**：宽度运动，类型为“时间-数-补间”组；



- 音符对象的数据结构：
  - **time**：出现的时间。整数，单位千分之一秒；
  - **duration**：持续时长。整数，单位千分之一秒；
  - **itemType**：物体类型，用于修改外观。整数；
  - **speed**：下落速度倍数，整数，单位为千分之一倍；
  - **x**：横向位置，0表示轨道最左侧，1000表示轨道最右侧，基准点位于音符纵向底部、横向中间。整数；
  - **z**：高度位置，0表示紧贴轨道，大于0时悬浮于轨道上空，1000表示悬浮高度与主场景宽度相同。整数；
  - **width**：宽度，0表示宽度无限小，1000表示与轨道宽度相同。整数；
  - **trackIndex**：轨道编号，决定该音符位于哪个轨道中。整数；
  - **linkedNoteIndex**：链接音符编号，值为 -1 时不链接其它音符，值大于等于 0 时，编号对应的音符将成为被链接的下一个音符。整数；
  - **clickSoundIndex**：按键音编号。短整数；
  - **soundFxIndex**：特效编号。比特；
  - **soundFxParamA**：特效参数甲。整数；
  - **soundFxParamB**：特效参数乙。整数；



- 时间点对象的数据结构：
  - **time**：出现的时间。整数，单位千分之一秒；
  - **duration**：特效时长。整数，单位千分之一秒；
  - **itemType**：（无效数据，可省略）
  - **speed**：（无效数据，可省略）
  - **x**：下落速度，影响该时间点到下一个时间点之间的音符下落速度。整数，单位**百分之一**倍；
  - **soundFxIndex**：特效编号。比特；
  - **soundFxParamA**：特效参数甲。整数；
  - **soundFxParamB**：特效参数乙。整数；



- 时间-数-补间的数据结构
  - **time**：出现的时间，该时间是本地时间，0表示与运动物体出现时间相同。整数，单位千分之一秒；
  - **value**：相应的值。整数，单位千分之一；
  - **tween**：补间编号，表示该运动点到下一个运动点之间的补间。整数；



- 时间-整数-补间的数据结构
  - **time**：出现的时间，该时间是本地时间，0表示与运动物体出现时间相同。整数，单位千分之一秒；
  - **value**：相应的值。整数；
  - **tween**：补间编号，表示该运动点到下一个运动点之间的补间。整数；



- 时间-数-数-补间的数据结构
  - **time**：出现的时间，该时间是本地时间，0表示与运动物体出现时间相同。整数，单位千分之一秒；
  - **a**：相应的第一个值。整数，单位千分之一；
  - **b**：相应的第二个值。整数，单位千分之一；
  - **tween**：补间编号，表示该运动点到下一个运动点之间的补间。整数；



- 谱面文件示例

  ```
  {
  
    "bpm": 140,
    "level": 1,
    "tag": "Normal",
    "createdTime": 637255000618400132,
    "shift": 0,
    "ratio": 1500,
    
    "stages": [
      {
        "itemType": 0,
        "time": 0,
        "duration": 86400000,
        "x": 0,
        "speed": 1000,
        "y": 0,
        "width": 1000,
        "height": 591,
        "rotation": 0,
        "pivotY": 0,
        "color": 0,
        "positions": [
          {
            "time": 0,
            "a": 500,
            "b": 295,
            "tween": 0
          }
        ],
        "rotations": [
          {
            "time": 0,
            "value": 0,
            "tween": 0
          }
        ],
        "colors": [],
        "widths": [],
        "heights": []
      }
    ],
    
    "tracks": [
      {
        "itemType": 0,
        "time": 1206,
        "duration": 3600,
        "x": 1000,
        "speed": 1000,
        "width": 100,
        "angle": 0,
        "stageIndex": 0,
        "color": 4,
        "hasTray": false,
        "xs": [],
        "angles": [],
        "colors": [],
        "widths": []
      }
    ],
    
    "notes": [
      {
        "itemType": 0,
        "time": 1714,
        "duration": 0,
        "x": 414,
        "speed": 1000,
        "z": 0,
        "width": 143,
        "trackIndex": 0,
        "linkedNoteIndex": -1,
        "clickSoundIndex": 0,
        "soundFxIndex": 0,
        "soundFxParamA": 0,
        "soundFxParamB": 0
      }
    ],
    
    "timings": [
      {
        "itemType": 0,
        "time": 0,
        "duration": 0,
        "x": 100,
        "speed": 0,
        "soundFxIndex": 0,
        "soundFxParamA": 0,
        "soundFxParamB": 0
      }
    ]
  }
  ```

  

- 特效编号对照表

  | 编号 |    Name     |    名称    |
  | :--: | :---------: | :--------: |
  |  0   |   (None)    | （无特效） |
  |  1   |   Glitch    |   鬼畜音   |
  |  2   |    Gate     |   盖特门   |
  |  3   | Short Delay |   短延迟   |
  |  4   | Side Chain  |   边锁链   |
  |  5   |  Bit Crush  |   比特毁   |
  |  6   | Knob Shoot  |   旋钮射   |
  |  7   | Tap Scratch |   刮磁带   |
  |  8   |   Flange    |   法兰盘   |
  |  9   | Pitch Shift |    跑调    |
  |  10  |  Low Pass   |    低通    |
  |  11  |  High Pass  |    高通    |
  |  12  |    Knob     |    旋钮    |
  |  13  |   Wobble    |    摇摆    |

  